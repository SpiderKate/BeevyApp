GitHub Copilot Chat Assistant — checklist:

High priority (P0) — fix now (security / correctness)
1. Move secret and disable debug
   - Why: secret_key is hardcoded and app runs with debug=True.
   - Fix: read SECRET_KEY from env and set debug=False in production (e.g., app.secret_key = os.environ["SECRET_KEY"]).
   - Files: app.py (top, and __main__ socketio.run(...)).
   - Est: 10–20 min.

2. Add CSRF protection
   - Why: all POST forms are unprotected.
   - Fix: install Flask-WTF and enable CSRFProtect(app). Update templates to include CSRF token.
   - Files: app.py + templates (login/register/create_art/etc).
   - Est: 30–60 min.

3. Patch broken editArt handler
   - Why: many bugs (uses users.password, wrong tuple accesses, SQL param mistakes, deleting using wrong ID).
   - Fix:
     - Use column names (sqlite3.Row) or destructure the fetched row into named vars.
     - For delete/hide/update, use WHERE id = ? and pass art_id (not art.author_id).
     - Verify provided password against the author’s password from the DB (not a non-existent users object).
   - Files: app.py function editArt.
   - Est: 60–120 min (careful testing required).

4. Validate and limit file uploads
   - Why: uploads are saved without type checks; DoS and RCE risk.
   - Fix:
     - Set MAX_CONTENT_LENGTH (e.g., 10MB).
     - Define ALLOWED_EXTENSIONS and check extension + verify image with Pillow (Image.open(...).verify()) before saving.
     - Enforce mime-type checks and limit example count/thumbnail size.
   - Files: app.py functions save_uploaded_file, create_art, settingsProfile.
   - Est: 60–90 min.

5. Prevent path traversal & use safe serving
   - Why: send_file uses user-provided DB path; validate to avoid serving outside static.
   - Fix: use send_from_directory(STATIC_ROOT, safe_relative_path) or Flask’s send_from_directory; validate normalized path starts inside STATIC_ROOT.
   - Files: download_art in app.py.
   - Est: 15–30 min.

Medium priority (P1) — correctness & resilience
6. Fix session mutation for verified_rooms
   - Why: session.setdefault(...).append(...) may not persist reliably.
   - Fix: do lst = session.get('verified_rooms', []); lst.append(room_ID); session['verified_rooms'] = lst.
   - Files: join_room_page in app.py.
   - Est: 5–10 min.

7. Normalize room visibility checks & DB usage
   - Why: code mixes True/False and strings ('private'); SQL uses TRUE literal inconsistently.
   - Fix: standardize DB column as INTEGER (0/1) or BOOLEAN semantics. In code, compare to 1/0 or bool(result[0]).
   - Files: join_room_page, draw, public/private listing queries.
   - Est: 20–40 min.

8. Make room_ID generation unique
   - Why: collisions possible.
   - Fix: loop until generated ID not found in rooms table (or use UUID4).
   - Files: create() in app.py.
   - Est: 10–20 min.

9. Cap or persist draw_history
   - Why: in-memory draw_history grows unbounded (DoS / OOM).
   - Fix: set MAX_HISTORY_PER_ROOM (e.g., 1000) and drop oldest events; consider using Redis or DB for persistent/scale-safe storage and multi-worker SocketIO.
   - Files: draw_history handling and socket handlers.
   - Est: 30–90 min (depending on persistence approach).

10. Ensure password-hash type consistency
    - Why: sometimes code encodes/decodes inconsistently (str vs bytes), potential TypeErrors.
    - Fix: store password hashes as text in DB (utf-8), and consistently do bcrypt.checkpw(password.encode(), db_hash.encode()).
    - Files: register, login, recover_account, settingsSecurity, settingsDelete.
    - Est: 20–40 min.

11. Fix settingsAccount “return” bug
    - Why: returns "User not found", (trailing comma) — invalid tuple.
    - Fix: return a proper template + status code or flash + redirect.
    - Files: settingsAccount in app.py.
    - Est: 5–10 min.

Lower priority (P2) — maintenance & hardening
12. Use sqlite3.Row and context managers
    - Why: code uses index positions (e.g., item[10]) — fragile and unreadable; many try/finally patterns to close.
    - Fix: set conn.row_factory = sqlite3.Row; use with sqlite3.connect(...) as conn: to auto-close.
    - Files: throughout app.py.
    - Est: 1–3 hours.

13. Centralize DB access & schema assumptions
    - Why: repeated SQL patterns across routes; easier to audit and test with a small data layer or helper functions.
    - Fix: create small helper module (db.py) with functions get_user_by_username, get_art, etc.
    - Files: new db.py + app.py changes.
    - Est: 2–6 hours.

14. Add upload directories under STATIC_ROOT constant
    - Why: currently paths built in multiple places; normalize by joining STATIC_ROOT + UPLOAD_FOLDER in one helper.
    - Fix: ensure all uploads go under STATIC_ROOT and that save_uploaded_file returns DB-safe relative paths.
    - Files: save_uploaded_file and create_art.
    - Est: 15–30 min.

15. Harden session cookies and other app config
    - Why: production should use secure cookie flags.
    - Fix: set app.config['SESSION_COOKIE_SECURE'] = True, SESSION_COOKIE_HTTPONLY = True, SESSION_COOKIE_SAMESITE = 'Lax/Strict' when env=production.
    - Files: app.py startup config.
    - Est: 10–15 min.

Testing, CI, observability
16. Add unit/integration tests
    - Why: catch regressions on auth, uploads, edit/delete flows.
    - Fix: add pytest tests for login/register, create_art (mock uploads), settingsDelete (soft delete), download permissions.
    - Est: variable; start with smoke tests (2–4 hours).

17. Add logging and error handling
    - Why: exceptions are sometimes returned as raw strings.
    - Fix: add structured logging, and return friendly error pages. Use Sentry or similar for production.
    - Est: 1–2 hours.

18. Add rate-limiting for sensitive endpoints
    - Why: brute-force risk for login/recover.
    - Fix: use Flask-Limiter with sensible limits on /login, /recover, /settings/delete.
    - Est: 30–60 min.

Documentation & deployment
19. Document env vars and deployment checklist
    - Include: SECRET_KEY, DATABASE path, UPLOAD limits, DEBUG toggle, storage backend (LOCAL vs S3), redis URL for SocketIO if scaled.
    - Est: 30–60 min.

20. Consider using Flask-Login + blueprint refactor
    - Why: cleaner auth management and route separation.
    - Est: refactor effort (several hours).

Quick code snippets (minimal) you can apply immediately
- Read secret from env:
  - app.secret_key = os.environ.get("SECRET_KEY") or raise RuntimeError("SECRET_KEY not set")
- Persist verified_rooms safely:
  - rooms = session.get('verified_rooms', []); rooms.append(room_ID); session['verified_rooms'] = rooms
- Cap draw_history:
  - draw_history.setdefault(room, []).append(data); if len(draw_history[room]) > MAX_HISTORY: draw_history[room].pop(0)

Next step I can take
- Produce a PR-ready patch for the top P0 items (secret/env, debug, CSRF, upload validation, editArt fix) — tell me which ones to include and I’ll prepare changes.
